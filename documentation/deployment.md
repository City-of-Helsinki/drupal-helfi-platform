# Deployment&#10&#10## Deployment tasks&#10&#10The deployment tasks are run when a container is first started. Any subsequent containers will check the value of `$OPENSHIFT_BUILD_NAME` to determine if deployment tasks need to be run.&#10&#10The tasks:&#10&#101. Run pre-deployment hooks. See [Deploy hooks](https://github.com/City-of-Helsinki/drupal-module-helfi-api-base/blob/main/documentation/deploy-hooks.md).&#102. Site is put into maintenance mode.&#103. `drush deploy` is run. See https://www.drush.org/latest/deploycommand/ for documentation about `drush deploy`.&#104. Run post-deployment hooks. See [Deploy hooks](https://github.com/City-of-Helsinki/drupal-module-helfi-api-base/blob/main/documentation/deploy-hooks.md).&#105. Maintenance mode is disabled.&#10&#10See the [deployment](/docker/openshift/entrypoints/20-deploy.sh) script for more up-to-date information.&#10&#10### Handling failures&#10&#10In case of a failure, an error message is sent to a configured Sentry instance. See [notify.php](/docker/openshift/notify.php) script for more documentation.&#10&#10In order to use this feature, you must define the following environment variables:&#10&#10```bash&#10SENTRY_DSN=your-sentry-dsn&#10# Should be same as APP_ENV&#10SENTRY_ENVIRONMENT=environment&#10```&#10&#10- See [Logging](/documentation/logging.md) for more documentation about Sentry.&#10- See https://helsinkisolutionoffice.atlassian.net/wiki/spaces/HEL/pages/6785826654/Ymp+rist+muuttujien+lis+ys+Azure+DevOpsissa for more documentation (in Finnish) on how to define environment variables.&#10&#10## Deployment preflight checks&#10&#10Preflight checks can be used to run assertions before deployment tasks are run. If any preflight assertion fails, the deployment will be marked as failed.&#10&#10See [preflight.php](/docker/openshift/preflight/preflight.php).&#10&#10### Custom preflight checks&#10&#10Create a new php file in `docker/openshift/preflight` folder and define `$preflight_checks['additionalFiles']` in your `public/sites/default/*.settings.php` file:&#10&#10You can create an exit condition by calling `preflight_failed('Error message');`. For example:&#10```php&#10<?php&#10&#10if (my_failed_condition) {&#10  preflight_failed('My condition failed with and error code %s', $error_code);&#10}&#10```&#10&#10### Defining required environment variables&#10&#10You can define required environment variables in your `public/sites/default/*.settings.php` files:&#10&#10```php&#10$preflight_checks['environmentVariables'][] = 'MY_REQUIRED_ENV_VARIABLE1';&#10$preflight_checks['environmentVariables'][] = 'MY_REQUIRED_ENV_VARIABLE2';&#10```&#10&#10